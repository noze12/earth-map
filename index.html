<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
		<style>
			body { margin: 0; }
		</style>
    <script src="https://unpkg.com/three@0.133.0/build/three.js"></script>
    <script src="https://unpkg.com/three@0.133.0/examples/js/controls/DeviceOrientationControls.js"></script>
    <script src="https://unpkg.com/three-globe"></script>
  <script> 
    Promise.all([
      new Promise((resolve) => window.navigator.geolocation.getCurrentPosition(p => resolve(p))),
      fetch('./ne_110m_admin_0_countries.json').then(res => res.json()),
    ]).then(([p, data]) => {
      const globe = new ThreeGlobe().polygonsData(data.features)
      globe
        .showGlobe(false)
        .polygonSideMaterial(
          new THREE.MeshNormalMaterial({
            opacity: 0,
            transparent: true,
          })
        )
        .polygonStrokeColor(() => 'black')
      const renderer = new THREE.WebGLRenderer()
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('main').appendChild(renderer.domElement)

      const scene = new THREE.Scene()
      scene.add(globe)
      scene.add(new THREE.AmbientLight(0xbbbbbb))
      scene.add(new THREE.DirectionalLight(0xffffff, 0.6))

      const camera = new THREE.PerspectiveCamera()
      camera.aspect = window.innerWidth / window.innerHeight
      camera.updateProjectionMatrix()
      camera.position.z = 99
      globe.rotateOnWorldAxis(new THREE.Vector3(0,1,0), -p.coords.longitude / 180 * Math.PI)
      globe.rotateOnWorldAxis(new THREE.Vector3(1,0,0), p.coords.latitude / 180 * Math.PI)
      
      const controls = new THREE.DeviceOrientationControls(camera);

      const animate = () => {
        renderer.render(scene, camera)
        controls.update()
        requestAnimationFrame(animate)
      }
      animate()
    })
  </script>
  </head>
  <body>
    <div id="main"></div>
  </body>
</html>